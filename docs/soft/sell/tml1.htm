<html><meta http-equiv="Content-Type" content="text/html; charset=GB2312"><link rel="stylesheet" type="text/css" href="../../img/TML.css"><Script src=../../img/menu.js></Script><title>视频游戏通用开发模块</title><meta name="keywords" content="国软,网络游戏,棋牌游戏,麻将游戏,军棋,象棋,围棋,五子棋,斗地主,梭哈,小游戏,连连看小游戏,双人小游戏,迷你小游戏,网页游戏,游戏开发,棋牌游戏开发">
<meta name="description" content="国软是在国内的网络游戏企业，旗下自主研发多款网络游戏、休闲游戏、棋牌游戏、竞技游戏、大型MMORPG游戏"><body><center><div id="page"><div id="top" align=right><br><br><br><br><br><br>
<a onClick="this.style.behavior='url(#default#homepage)';this.setHomePage('http://www.guoruan.com');" href="#">设为首页</a>　|　<a href="Javascript:window.external.addFavorite('http://www.guoruan.com','国软股份有限公司')">加入收藏</a>　|　<a href="../../tml/Conncetus.htm">联系我们</a>　|　<a href="../../tml/Statement.htm">法律声明</a>　|　<a href="../../tml/pay.htm">支付方式</a></div></div>
<div style="width:100%;height:31px;background:url(../../img/TML8.jpg)">
<div style="width:1004" align=left>　　　　　　　<a href="../../index.htm"><img src="../../img/TML9.jpg" title="网站首页"></a> 　<a href="../../tml/Introduction.htm"><img src=../../img/TML10.jpg title="公司信息"></a>　　　<a href="../../tml/Production.htm"><img src=../../img/TML11.jpg title="产品体系"></a>　　　<a href="../../tml/technology.htm"><img src=../../img/TML12.jpg title="技术培训"></a>　　　<a href="../../tml/job.htm"><img src=../../img/TML13.jpg title="招聘信息"></a>　　　<a href="../../tml/Honor.htm"><img src=../../img/TML100.jpg title="荣誉资质"></a>
<!--公司相关网站连接开始-->
<div id="correlation">
    <div id="t_select">
        <div id="t_selected" onclick="shlist();" onmouseover="cws(true);" onmouseout="cws(false);"
            onblur="hlist()">
            访问国软相关产品网站</div>
        <div id="t_select-list" onmouseover="cws(true);" onmouseout="cws(false);">
            <a href="http://rpg.guoruan.com/" onclick="changesever(this);" target="_blank">《封神》MMORPG网站</a>
            <a href="http://www.euqq.com/" onclick="changesever(this);" target="_blank">《益友休闲游戏》平台</a>
            <a href="http://www.pukeyule.com/" onclick="changesever(this);" target="_blank">《闯关赛》棋牌竞技平台</a>
            <a href="http://www.hk163.com/" onclick="changesever(this);" target="_blank">《皇嘉Flash棋牌游戏》</a>
            <a href="http://www.qeyx.com/" onclick="changesever(this);" target="_blank">《企鹅游戏》平台</a>
            <a href="http://www.xydb.com/" onclick="changesever(this);" target="_blank">《真钱游戏》平台</a>
            <a href="http://www.fengzi.net/" onclick="changesever(this);" target="_blank">疯子创作室官方网站</a>
            <a href="http://www.tml.cn/" onclick="changesever(this);" target="_blank">TML实验室官方网站</a>
			</div>		
    </div>
</div>
</div>
</div>


<div align="center"  id="banner-small"><img src="../../img/b-xw.jpg" width="990" height="120"></div>
<!--内容开始-->
<div id="contentbox">
<div id="content">
<div id="main-small">
<div class="linemenu">
  您当前的位置：<a href="../index.htm">首页</a> &gt; 
  <a href="../../tml/Production.htm">产品体系</a></div>
  
  <table>
  
  <tr><td valign=top>
<div id="producemenu"><iframe src="../../tml/menu.htm" height=1100 width=210 scrolling="no" border="0" frameborder="0"></iframe></div></td>
<td valign=top>
<div id="txt">

 <h1>视频游戏通用开发模块</h1>　





               视频模块功能:<br />
           （1）	保证所开发的本软件产品符合中华人民共和国有关该类产品的法律规定。<br />
           （2）	检测本地是否存在可用的视频输入设备。<br />
           （3）	检测本地是否存在可用的音频输入设备。<br />
           （4）	创建指定大小，位置的窗口（可被创建多个）。<br />
           （5）	销毁窗口。<br />
           （6）	取得指定的已打开窗口的句柄。<br />
           （7）	向指定的窗口显示视频数据。<br />
           （8）	播放音频数据。<br />
           （9）	获取本地视频输入设备的数据（被压缩过）。<br />
           （10）	获取本地音频输入设备的数据（被压缩过）。<br />
           （11）	提供音视频数据可同步的方法。<br />
           （12）	提供可设置音视频质量的方法。<br />
           （13）	可设置视频大小。<br />
           （14）	音视频数据压缩比能够满足网络传输要求。 <br />
           
           <p>共有两个DLL文件<br />
             vcoder.dll和AVMng.dll<br />
             vcoder.dll负责视频和音频的压缩和解压缩<br />
             AVMng.dll负责创建和管理视频和音频的对象<br />
           </p>
             <p>开发方法：<br />
               包含头文件 TMLavmng.h<br />
               将TMLAVMng.lib包含到工程中即可,,,,,该文件存放在TMLAVMng.rar中，需购买后才可以获得</p>
             <p>使用方法请参考例子的源代码</p>
             <p>具体功能和方法，请参考TMLavmng.h文件，均有详细注释，内容如下：</p>
             <p>&nbsp;</p>
             <p>#pragma once<br />
               #ifndef CTML_AUDIO_VIDEO_MANAGER_2005<br />
               #define CTML_AUDIO_VIDEO_MANAGER_2005</p>
             <p>//国软公司 (C) www.GuoRuan.com 保留所有权利。<br />
               // TML&gt;&gt; 疯子创作室 www.FengZi.net </p>
             <p>//定义输出<br />
               #define EXT_CLASS_Video _declspec(dllimport)//导入型DLL</p>
             <p>#define SIZE_AUDIO_FRAME	960//录音帧大小<br />
               #define SIZE_AUDIO_PACKED	60//录音包大小<br />
               #define TML_WAV_NUM_BUF		10//为了使录音连续，采用10个缓冲区,提供音视频数据同步<br />
               #define UDP_PACK_COUNT		5//为了使视频连续，采用5个视频分包<br />
               #define MAX_VIDEO			6//最大视频数量 <br />
               #define MAX_UDP_SIZE   		1460//微软的说法是1460Byte最佳,使音视频数据压缩比满足最小网络传输要求</p>
             <p>#define FRM_SYS_MSG			WM_USER+501 //系统提示信息消息ID<br />
               #define FRM_SYS_MSG_CHAR	WM_USER+502 //系统提示信息消息字符<br />
               #define SEND_VIDEO			WM_USER+702  //发送视频信息<br />
               #define SEND_AUDIO			WM_USER+503  //发送音频信息<br />
               #define BAND_VIDEO			WM_USER+504  //群发视频信息<br />
               #define BAND_AUDIO			WM_USER+505  //群发音频信息</p>
             <p>#define OUT_BMP_WIDTH	160<br />
               #define OUT_BMP_HEIGHT	120</p>
             <p>#define TMLbmpSize OUT_BMP_WIDTH*OUT_BMP_HEIGHT*3//当biBitCount=24时,1个像素占3个字节;</p>
             <p>#define FLAG_AUDIO			0x3131<br />
               #define FLAG_VIDEO			0x3132</p>
             <p>#include &lt;vfw.h&gt;<br />
               #include &quot;TMLvcoder.h&quot;</p>
             <p>class CTMLvcoder //封装了压缩函数<br />
               {<br />
               public://公共函数，外部可调用<br />
               CTMLvcoder() ; <br />
               ~CTMLvcoder() ; <br />
               void            Open();<br />
               void            Close();<br />
               int				dec_core(LPVOID bitstream, LPVOID image, int bs_size) ;<br />
               int				enc_core(LPVOID image,LPVOID bitstream, int *key);</p>
             <p>private://内部变量，视频的基本的属性<br />
               static void     XVID_GLOBAL_INIT();<br />
               void *           m_enc_handle;<br />
               void *           m_dec_handle;<br />
               };</p>
             <p>//视频数据包（不包含视频数据）<br />
               typedef struct<br />
               {<br />
               short	flag;<br />
               BYTE	id;<br />
               BYTE	bDeskStation;//位置<br />
               BYTE	subid;<br />
               unsigned short video_size;<br />
               }PACK_VIDEO;</p>
             <p>//音频数据包（包含音频数据）<br />
               typedef struct<br />
               {	short flag; <br />
               BYTE bDeskStation;//桌子位置<br />
               BYTE data[SIZE_AUDIO_PACKED];<br />
               }PACK_AUDIO;</p>
             <p>//视频包<br />
               typedef struct <br />
               {<br />
               BITMAPINFO* header;<br />
               LPVOID bits;<br />
               }VideoPack;</p>
             <p>//视频显示窗口数据结构<br />
               typedef struct <br />
               {<br />
               HWND m_hVideoWnd;<br />
               bool m_bOpenVideo;<br />
               bool m_bOpenVioce;<br />
               bool m_bCamera;<br />
               }VideoViewStruct;</p>
             <p>//视频控制类<br />
               class EXT_CLASS_Video TMLavmng<br />
               {<br />
               /**************************录音部分************************************/<br />
               private:<br />
               //初始化音频<br />
               bool initAudio();<br />
               //声音输入线程，包括声音的压缩<br />
               static DWORD WINAPI AudioInThreadProc(LPVOID lpParameter);<br />
               //打开录音设备<br />
               BOOL OpenDev(WAVEFORMATEX* pfmt,DWORD dwCallback,DWORD dwCallbackInstance,DWORD fdwOpen);<br />
               //为录音分配一组内存<br />
               BOOL AllocBuffer();<br />
               //压缩音频原始数据并发送出去<br />
               void OnEncodeAudioData(char* pin);</p>
             <p> //变量<br />
               //音频网络数据包<br />
               PACK_AUDIO m_AudioPack;<br />
               //本地录音数据包<br />
               char					m_AudioLocal[SIZE_AUDIO_FRAME];<br />
               //录音句柄<br />
               HANDLE					m_hAudioIn;<br />
               //录音线程ID<br />
               DWORD					m_dwAudioInId;<br />
               //录音硬件句柄<br />
               HWAVEIN					m_hIn;<br />
               WAVEHDR*				m_pHdr;<br />
               /**************************播音部分************************************/</p>
             <p> //音频输出线程，包括音频解码<br />
               static DWORD WINAPI AudioOutThreadProc(LPVOID lpParameter);<br />
               //播放一块数据<br />
               BOOL AudioPlay(char* buf,UINT uSize);<br />
               //变量<br />
               //解码后的播音数据<br />
               char m_AudioRemote[SIZE_AUDIO_FRAME];<br />
               //播音句柄<br />
               HANDLE m_hAudioOut;<br />
               //播音线程ID<br />
               DWORD m_dwAudioOutId;<br />
               //播音缓冲块数量<br />
               int m_iAudioOutBuf;<br />
               //播音硬件句柄<br />
               HWAVEOUT m_hOut;<br />
               /**************************视频部分************************************/<br />
               //私有变量<br />
               private:<br />
               //定义编解码器指针：<br />
               CTMLvcoder *		m_pVcoder[MAX_VIDEO]; <br />
               bool				m_bEnable;//是否启用<br />
               UINT				m_iPackID;//包ID<br />
               char				m_VideoPack[MAX_UDP_SIZE];//我要发送的视频包，压缩后<br />
               char				m_VideoRev[MAX_VIDEO][MAX_UDP_SIZE*UDP_PACK_COUNT];//收到的视频包，每个用户一个变量，不能混<br />
               char				m_OutBmp[TMLbmpSize];//解开远程的画布缓存，所谓的双缓存，多人的画图可混合<br />
               char				m_MyEnData[OUT_BMP_WIDTH*OUT_BMP_WIDTH];<br />
               HWND				m_hTMLframe;//框架句柄<br />
               BYTE				m_bTeamPeople;//桌面人数<br />
               BYTE				m_bMeDeskStation;//我的位置<br />
               VideoViewStruct  *	m_pVideoView[MAX_VIDEO]; //视频句柄<br />
               HWND				m_CapWnd;<br />
               CAPTUREPARMS		m_CapConfig;<br />
               BITMAPINFO			m_GetBitFormat;<br />
               BITMAPINFO  		m_SetBitFormat;<br />
               bool				m_bCanP2P[MAX_VIDEO]; //是否P2P通了</p>
             <p>private://私有函数<br />
               //回调函数<br />
               static LRESULT CALLBACK OnCaptureVideo(HWND hWnd, LPVIDEOHDR lpheader);</p>
             <p> //是否发送视频<br />
               void CanSendVideoData(LPVOID pv); </p>
             <p> //视频压缩并发送<br />
               void EncodeSendVideo(LPVOID pv);</p>
             <p> ///初始压缩管理器 <br />
               void InitParam();</p>
             <p> //发送视频<br />
               void SendVideo(BYTE bDstStation,VideoPack * pVideoPack);</p>
             <p> //照相<br />
               void Camera(VideoPack * pVideoPack);</p>
             <p>public:<br />
               //构造函数<br />
               TMLavmng(void);</p>
             <p> //析构函数<br />
               ~TMLavmng(void);</p>
             <p> //初始化<br />
               void initAVmng(BYTE bTeamPeople,BYTE bMeDeskStation,HWND hTMLframe);</p>
             <p> //检测本地是否存在可用的视频输入设备<br />
               bool IsExistCap();</p>
             <p> //检测本地是否存在可用的音频输入设备<br />
               bool IsExistAudio();</p>
             <p> //设置音视频质量<br />
               void SetQuality(BYTE tQuality);</p>
             <p> //关闭摄像头<br />
               void ExitCap();</p>
             <p> //打开摄像头<br />
               void OpenCap(int DrvID);</p>
             <p> //视频解码，并播放<br />
               void OnDecodeVideoData(PACK_VIDEO* ppv);</p>
             <p> //音频解码，并将音频数据发送到想要数据的窗口<br />
               void OnDecodeAudioData(char *pin,BYTE bDstStation);</p>
             <p> //设置能P2P的座号<br />
               void SetCanP2P(BYTE bStation);</p>
             <p> //获得该座号是否可以P2P<br />
               bool GetCanP2P(BYTE bStation);</p>
             <p> //获得视频视图的指针<br />
               VideoViewStruct * GetVideoView(BYTE bStation);</p>
             <p> //设置视频视图的指针<br />
               void SetVideoView(VideoViewStruct * pVideoView,BYTE bStation);<br />
  <br />
               //绘制视频函数 静态成员函数<br />
               static void DrawVideo(HWND h, <br />
               IN int      xDst,<br />
               IN int      yDst,<br />
               IN int      dxDst,<br />
               IN int      dyDst,<br />
               VideoPack * pVideoPack<br />
               );<br />
               };</p>
             <p>#endif</p>
             <p><a style="color:#F00" href="vcode.rar">源代码下载 ：http://www.guoruan.com/soft/sell/vcode.rar</a></p>


</td>
         </tr>

</table>
</td></tr></table>


 <marquee scrollAmount=10000 width="1" height="6">
                     具体产品如下：<br />
                   益友斗地主、益友棋牌软件、益友牌类游戏、益友麻将游戏、益友棋牌游戏源程序、益友网页版棋牌游戏、益友棋牌游戏程序、益友棋牌游戏代码、益友棋牌游戏平台出售、益友flash棋牌游戏源代码、益友flash棋牌游戏、益友flash棋牌游戏程序、益友flash棋牌游戏软件、益友flash棋牌游戏开发、益友棋牌游戏源程序、购买益友棋牌游戏、购买益友网络棋牌、益友网络棋牌平台开发、益友网络棋牌游戏开发、益友棋牌游戏开发、开发益友棋牌游戏、益友棋牌游戏开发公司、益友网络棋牌开发公司、益友视频游戏开发、益友视频语音棋牌游戏开发 .                  
                   
                   </marquee>  
                   

  <h1>&nbsp;</h1>
<p><br>
</p>
</div>
</div>
</div>
</div></div>
<div class="clear"></div>
<!--底部开始-->
<div id="foot">
    <div class="copyright">
        <div class="foot-nav">
            <dl>
                <dd>
                    <a href="Javascript:window.external.addFavorite('http://www.guoruan.com','国软股份有限公司')" target="_self">加入收藏 </a>
                </dd>
                <dd>
                    <a href="../../index.htm">网站首页 </a></dd><dd><a href="../../tml/pay.htm">支付方式 </a></dd>
                </dd>
                <dd>
                    <a href="../../tml/Conncetus.htm">联系我们 </a>                </dd>
                <dd>
                    <a onClick="this.style.behavior='url(#default#homepage)';this.setHomePage('http://www.guoruan.com');" href="#">设为首页</a></dd>
            </dl>
        </div>
        <div class="copyinfo">
           Copyright &#169; 1997 - 2012 Tencent. All Rights Reserved.  国软公司 版权所有 京ICP证09000566号</div>
</div></div></div>
</body>
</html>