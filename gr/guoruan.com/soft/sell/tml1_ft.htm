<html><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><link rel="stylesheet" type="text/css" href="../../img/TML.css"><Script src=../../img/menu.js></Script><title>視頻遊戲通用開發模塊</title><meta name="keywords" content="国软,网络游戏,棋牌游戏,麻将游戏,军棋,象棋,围棋,五子棋,斗地主,梭哈,小游戏,连连看小游戏,双人小游戏,迷你小游戏,网页游戏,游戏开发,棋牌游戏开发"><meta name="description" content="国软是中国领先的软件外包品牌，携二十余年行业经验为全球客户代工开发各类软件产品，其中游戏外包较多，自主研发多款网络游戏、手机游戏、网页游戏、休闲游戏、棋牌游戏、竞技游戏、大型MMORPG游戏，其中棋牌类游戏近500款，居行业领先。"><body><center><div id="page"><div id="top_ft" align=right><br><br><br><br><br><br>
<a href="http://www.GuoRuan.com">&#x4E2D;&#x6587;&#x7248;</a> | <a href="http://www.guoruan.com.cn">Japanese</a> | <a href="http://www.goreat.com">English</a> | <a href="../../tml/Conncetus_ft.htm">聯繫我們</a> | <a href="../../tml/Statement_ft.htm">法律聲明</a> | <a href="../../tml/pay_ft.htm">支付方式</a> | <a href="../bug/index_EN.asp">反饋建議</a></a></div></div>
<div style="width:100%;height:31px;background:url(../../img/TML8.jpg)">
<div style="width:1004" align=left>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="../../index_ft.htm"><img src="../../img/TML9_ft.jpg" title="首頁"></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="../../tml/Introduction_ft.htm"><img src=../../img/TML10_ft.jpg title="公司信息"></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="../../tml/Production_ft.htm"><img src=../../img/TML11_ft.jpg title="產品體系"></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="../../tml/technology_ft.htm"><img src=../../img/TML12_ft.jpg title="技術培訓"></a>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="../../tml/job_ft.htm"><img src=../../img/TML13_ft.jpg title="招聘信息"></a>
  
  <div id="correlation">
    <div id="t_select">
        <div id="t_selected" onClick="shlist();" onMouseOver="cws(true);" onMouseOut="cws(false);"onblur="hlist()">訪問國軟相關產品網站</div>
        <div id="t_select-list" onMouseOver="cws(true);" onMouseOut="cws(false);">
           <a href="http://rpg.guoruan.com/" onClick="changesever(this);" target="_blank">《封神》MMORPG網站</a>
            <a href="http://www.ds778.com/" onClick="changesever(this);" target="_blank">《德順棋牌遊戲》平台</a>
            <a href="http://www.euqq.com/" onClick="changesever(this);" target="_blank">《益友休閒遊戲》平台</a>
            <a href="http://www.pukeyule.com/" onClick="changesever(this);" target="_blank">《闖關賽》棋牌競技平台</a>
            <a href="http://www.hk163.com/" onClick="changesever(this);" target="_blank">《皇嘉Flash棋牌遊戲》</a>
            <a href="http://www.qeyx.com/" onClick="changesever(this);" target="_blank">《企鵝遊戲》平台</a>
            <a href="http://www.xydb.com/" onClick="changesever(this);" target="_blank">《真錢遊戲》平台</a>
            <a href="http://www.fengzi.net/" onClick="changesever(this);" target="_blank">TML實驗室官方網站</a>
            <a href="http://www.tml.cn/" onClick="changesever(this);" target="_blank">喔喔堂(合作夥伴網站)</a> 
		</div>		
    </div>
</div>
</div>
</div>


<div align="center"  id="banner-small"><img src="../../img/b-xw_ft.jpg" width="990" height="120"></div>

<div id="contentbox">
<div id="content">
<div id="main-small">
<div class="linemenu">
   您當前的位置：<a href="../../index_ft.htm">首頁</a> &gt;<a href="../../tml/Production_ft.htm">產品體系</a></div>
  
  <table>
  
  <tr><td valign=top>
<div id="producemenu"><iframe src="../../tml/menu_ft.htm" height=1100 width=210 scrolling="no" border="0" frameborder="0"></iframe></div></td>
<td valign=top>
<div id="txt">

 <h1>視頻遊戲通用開發模塊</h1>
 視頻模塊功能:<br>
（1） 保證所開發的本軟件產品符合中華人民共和國有關該類產品的法律規定。<br>
（2） 檢測本地是否存在可用的視頻輸入設備。<br>
（3） 檢測本地是否存在可用的音頻輸入設備。<br>
（4） 創建指定大小，位置的窗口（可被創建多個）。<br>
（5） 銷毀窗口。<br>
（6） 取得指定的已打開窗口的句柄。<br>
（7） 向指定的窗口顯示視頻數據。<br>
（8） 播放音頻數據。<br>
（9） 獲取本地視頻輸入設備的數據（被壓縮過）。<br>
（10） 獲取本地音頻輸入設備的數據（被壓縮過）。<br>
（11） 提供音視頻數據可同步的方法。<br>
（12） 提供可設置音視頻質量的方法。<br>
（13） 可設置視頻大小。
（14） 音視頻數據壓縮比能夠滿足網絡傳輸要求。<br>

 
 <br />
 <p>          
     共有兩個DLL文件<br>
vcoder.dll和AVMng.dll<br>
vcoder.dll負責視頻和音頻的壓縮和解壓縮<br>
AVMng.dll負責創建和管理視頻和音頻的對象<br>


開發方法：<br>
包含頭文件 TMLavmng.h<br>
將TMLAVMng.lib包含到工程中即可,,,,,該文件存放在TMLAVMng.rar中，需購買後才可以獲得<br>

使用方法請參考例子的源代碼<br>

具體功能和方法，請參考TMLavmng.h文件，均有詳細註釋，內容如下：<br>

            <p>&nbsp;</p>
             <p>#pragma once<br />
               #ifndef CTML_AUDIO_VIDEO_MANAGER_2005<br />
               #define CTML_AUDIO_VIDEO_MANAGER_2005</p>
             <p>//国软公司 (C) www.GuoRuan.com 保留所有权利。<br />
               // TML&gt;&gt; 疯子创作室 www.FengZi.net </p>
             <p>//定义输出<br />
               #define EXT_CLASS_Video _declspec(dllimport)//导入型DLL</p>
             <p>#define SIZE_AUDIO_FRAME	960//录音帧大小<br />
               #define SIZE_AUDIO_PACKED	60//录音包大小<br />
               #define TML_WAV_NUM_BUF		10//为了使录音连续，采用10个缓冲区,提供音视频数据同步<br />
               #define UDP_PACK_COUNT		5//为了使视频连续，采用5个视频分包<br />
               #define MAX_VIDEO			6//最大视频数量 <br />
               #define MAX_UDP_SIZE   		1460//微软的说法是1460Byte最佳,使音视频数据压缩比满足最小网络传输要求</p>
             <p>#define FRM_SYS_MSG			WM_USER+501 //系统提示信息消息ID<br />
               #define FRM_SYS_MSG_CHAR	WM_USER+502 //系统提示信息消息字符<br />
               #define SEND_VIDEO			WM_USER+702  //发送视频信息<br />
               #define SEND_AUDIO			WM_USER+503  //发送音频信息<br />
               #define BAND_VIDEO			WM_USER+504  //群发视频信息<br />
               #define BAND_AUDIO			WM_USER+505  //群发音频信息</p>
             <p>#define OUT_BMP_WIDTH	160<br />
               #define OUT_BMP_HEIGHT	120</p>
             <p>#define TMLbmpSize OUT_BMP_WIDTH*OUT_BMP_HEIGHT*3//当biBitCount=24时,1个像素占3个字节;</p>
             <p>#define FLAG_AUDIO			0x3131<br />
               #define FLAG_VIDEO			0x3132</p>
             <p>#include &lt;vfw.h&gt;<br />
               #include &quot;TMLvcoder.h&quot;</p>
             <p>class CTMLvcoder //封装了压缩函数<br />
               {<br />
               public://公共函数，外部可调用<br />
               CTMLvcoder() ; <br />
               ~CTMLvcoder() ; <br />
               void            Open();<br />
               void            Close();<br />
               int				dec_core(LPVOID bitstream, LPVOID image, int bs_size) ;<br />
               int				enc_core(LPVOID image,LPVOID bitstream, int *key);</p>
             <p>private://内部变量，视频的基本的属性<br />
               static void     XVID_GLOBAL_INIT();<br />
               void *           m_enc_handle;<br />
               void *           m_dec_handle;<br />
               };</p>
             <p>//视频数据包（不包含视频数据）<br />
               typedef struct<br />
               {<br />
               short	flag;<br />
               BYTE	id;<br />
               BYTE	bDeskStation;//位置<br />
               BYTE	subid;<br />
               unsigned short video_size;<br />
               }PACK_VIDEO;</p>
             <p>//音频数据包（包含音频数据）<br />
               typedef struct<br />
               {	short flag; <br />
               BYTE bDeskStation;//桌子位置<br />
               BYTE data[SIZE_AUDIO_PACKED];<br />
               }PACK_AUDIO;</p>
             <p>//视频包<br />
               typedef struct <br />
               {<br />
               BITMAPINFO* header;<br />
               LPVOID bits;<br />
               }VideoPack;</p>
             <p>//视频显示窗口数据结构<br />
               typedef struct <br />
               {<br />
               HWND m_hVideoWnd;<br />
               bool m_bOpenVideo;<br />
               bool m_bOpenVioce;<br />
               bool m_bCamera;<br />
               }VideoViewStruct;</p>
             <p>//视频控制类<br />
               class EXT_CLASS_Video TMLavmng<br />
               {<br />
               /**************************录音部分************************************/<br />
               private:<br />
               //初始化音频<br />
               bool initAudio();<br />
               //声音输入线程，包括声音的压缩<br />
               static DWORD WINAPI AudioInThreadProc(LPVOID lpParameter);<br />
               //打开录音设备<br />
               BOOL OpenDev(WAVEFORMATEX* pfmt,DWORD dwCallback,DWORD dwCallbackInstance,DWORD fdwOpen);<br />
               //为录音分配一组内存<br />
               BOOL AllocBuffer();<br />
               //压缩音频原始数据并发送出去<br />
               void OnEncodeAudioData(char* pin);</p>
             <p> //变量<br />
               //音频网络数据包<br />
               PACK_AUDIO m_AudioPack;<br />
               //本地录音数据包<br />
               char					m_AudioLocal[SIZE_AUDIO_FRAME];<br />
               //录音句柄<br />
               HANDLE					m_hAudioIn;<br />
               //录音线程ID<br />
               DWORD					m_dwAudioInId;<br />
               //录音硬件句柄<br />
               HWAVEIN					m_hIn;<br />
               WAVEHDR*				m_pHdr;<br />
               /**************************播音部分************************************/</p>
             <p> //音频输出线程，包括音频解码<br />
               static DWORD WINAPI AudioOutThreadProc(LPVOID lpParameter);<br />
               //播放一块数据<br />
               BOOL AudioPlay(char* buf,UINT uSize);<br />
               //变量<br />
               //解码后的播音数据<br />
               char m_AudioRemote[SIZE_AUDIO_FRAME];<br />
               //播音句柄<br />
               HANDLE m_hAudioOut;<br />
               //播音线程ID<br />
               DWORD m_dwAudioOutId;<br />
               //播音缓冲块数量<br />
               int m_iAudioOutBuf;<br />
               //播音硬件句柄<br />
               HWAVEOUT m_hOut;<br />
               /**************************视频部分************************************/<br />
               //私有变量<br />
               private:<br />
               //定义编解码器指针：<br />
               CTMLvcoder *		m_pVcoder[MAX_VIDEO]; <br />
               bool				m_bEnable;//是否启用<br />
               UINT				m_iPackID;//包ID<br />
               char				m_VideoPack[MAX_UDP_SIZE];//我要发送的视频包，压缩后<br />
               char				m_VideoRev[MAX_VIDEO][MAX_UDP_SIZE*UDP_PACK_COUNT];//收到的视频包，每个用户一个变量，不能混<br />
               char				m_OutBmp[TMLbmpSize];//解开远程的画布缓存，所谓的双缓存，多人的画图可混合<br />
               char				m_MyEnData[OUT_BMP_WIDTH*OUT_BMP_WIDTH];<br />
               HWND				m_hTMLframe;//框架句柄<br />
               BYTE				m_bTeamPeople;//桌面人数<br />
               BYTE				m_bMeDeskStation;//我的位置<br />
               VideoViewStruct  *	m_pVideoView[MAX_VIDEO]; //视频句柄<br />
               HWND				m_CapWnd;<br />
               CAPTUREPARMS		m_CapConfig;<br />
               BITMAPINFO			m_GetBitFormat;<br />
               BITMAPINFO  		m_SetBitFormat;<br />
               bool				m_bCanP2P[MAX_VIDEO]; //是否P2P通了</p>
             <p>private://私有函数<br />
               //回调函数<br />
               static LRESULT CALLBACK OnCaptureVideo(HWND hWnd, LPVIDEOHDR lpheader);</p>
             <p> //是否发送视频<br />
               void CanSendVideoData(LPVOID pv); </p>
             <p> //视频压缩并发送<br />
               void EncodeSendVideo(LPVOID pv);</p>
             <p> ///初始压缩管理器 <br />
               void InitParam();</p>
             <p> //发送视频<br />
               void SendVideo(BYTE bDstStation,VideoPack * pVideoPack);</p>
             <p> //照相<br />
               void Camera(VideoPack * pVideoPack);</p>
             <p>public:<br />
               //构造函数<br />
               TMLavmng(void);</p>
             <p> //析构函数<br />
               ~TMLavmng(void);</p>
             <p> //初始化<br />
               void initAVmng(BYTE bTeamPeople,BYTE bMeDeskStation,HWND hTMLframe);</p>
             <p> //检测本地是否存在可用的视频输入设备<br />
               bool IsExistCap();</p>
             <p> //检测本地是否存在可用的音频输入设备<br />
               bool IsExistAudio();</p>
             <p> //设置音视频质量<br />
               void SetQuality(BYTE tQuality);</p>
             <p> //关闭摄像头<br />
               void ExitCap();</p>
             <p> //打开摄像头<br />
               void OpenCap(int DrvID);</p>
             <p> //视频解码，并播放<br />
               void OnDecodeVideoData(PACK_VIDEO* ppv);</p>
             <p> //音频解码，并将音频数据发送到想要数据的窗口<br />
               void OnDecodeAudioData(char *pin,BYTE bDstStation);</p>
             <p> //设置能P2P的座号<br />
               void SetCanP2P(BYTE bStation);</p>
             <p> //获得该座号是否可以P2P<br />
               bool GetCanP2P(BYTE bStation);</p>
             <p> //获得视频视图的指针<br />
               VideoViewStruct * GetVideoView(BYTE bStation);</p>
             <p> //设置视频视图的指针<br />
               void SetVideoView(VideoViewStruct * pVideoView,BYTE bStation);<br />
  <br />
               //绘制视频函数 静态成员函数<br />
               static void DrawVideo(HWND h, <br />
               IN int      xDst,<br />
               IN int      yDst,<br />
               IN int      dxDst,<br />
               IN int      dyDst,<br />
               VideoPack * pVideoPack<br />
               );<br />
               };</p>
             <p>#endif</p>
             <p><a style="color:#F00" href="vcode.rar">源代碼下載: http://www.guoruan.com/soft/sell/vcode.rar</a></p>


</td>
         </tr>

</table>
</td></tr></table>


 <marquee scrollAmount=10000 width="1" height="6">
  具體產品如下：<br />
        益友斗地主、益友棋牌軟件、益友牌類游戲、益友麻將游戲、益友棋牌遊戲源程序、益友網頁版棋牌遊戲、益友棋牌遊戲程序、益友棋牌遊戲代碼、益友棋牌遊戲平台出售、益友flash棋牌遊戲源代碼、益友flash棋牌遊戲、益友flash棋牌遊戲程序、益友flash棋牌遊戲軟件、益友flash棋牌遊戲開發、益友棋牌遊戲源程序、購買益友棋牌遊戲、購買益友網絡棋牌、益友網絡棋牌平台開發、益友網絡棋牌遊戲開發、益友棋牌遊戲開發、開發益友棋牌遊戲、益友棋牌遊戲開發公司、益友網絡棋牌開發公司、益友視頻遊戲開發、益友視頻語音棋牌遊戲開發      
                                     </marquee>  
                   

  <h1>&nbsp;</h1>
<p><br>
</p>
</div>
</div>
</div>
<div class="clear"></div>

<div id="foot">
    <div class="copyright">
        <div class="foot-nav">
            <dl>
                <dd><a href="Javascript:window.external.addFavorite('http://www.GuoRuan.com','China's Software Outsourcing Brand')">加入收藏</a></dd>
                <dd><a href="../../index_ft.htm">網站首頁</a></dd>
                 <dd><a href="../../tml/pay_ft.htm">支付方式</a> </dd>
                <dd><a href="../../tml/Conncetus_ft.htm">聯繫我們</a></dd>
                <dd><a href="bug/index_ft.asp">反饋建議</a></dd>
                <dd><a onClick="this.style.behavior='url(#default#homepage)';this.setHomePage('http://www.GuoRuan.com');" href="#">設為首頁</a></dd>
            </dl> 
        </div>
        <div class="copyinfo">
          Copyright &#169; 1997 - 2010 All Rights Reserved.  国软公司 版权所有 京ICP证09000566号</div>
</div></div>
</body>
</html>